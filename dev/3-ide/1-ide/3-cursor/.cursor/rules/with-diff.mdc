---

description: 差分確認: ドキュメントの変更差分を確認するためのルール
globs: docs/\*_/_.md
alwaysApply: false

---

# ドキュメント差分確認ガイド

ドキュメントの変更前後の差分を確認し、変更の影響や整合性を評価するためのガイドラインです。このルールは、docs フォルダ内の要件定義・設計ドキュメントの変更を追跡し、差分を確認するための基盤を提供します。

## 機能概要

このルールは主に以下の機能を提供します：

1. **main ブランチとの差分取得**: docs ディレクトリの現在の作業状態と main ブランチとの差分を取得
2. **差分情報の他ルールへの連携**: 取得した差分情報を他のルール（create-docs, of-detailed-requirements 等）で活用
3. **変更の評価と分析**: 差分の内容を分析し、ドキュメント間の整合性を評価

## 初期処理

```bash
# docsディレクトリのmainブランチとの差分を取得
DOCS_DIFF_WITH_MAIN=$(git diff origin/main HEAD -- docs)
if [ -z "$DOCS_DIFF_WITH_MAIN" ]; then
  echo "mainブランチとの差分はありません。"
else
  echo "mainブランチとの差分:"
  echo "$DOCS_DIFF_WITH_MAIN"

  # 変更されたファイル一覧
  CHANGED_FILES=$(git diff --name-only origin/main HEAD -- docs)
  echo "変更されたファイル:"
  echo "$CHANGED_FILES"
fi
```

## 使用方法

このルールは docs ディレクトリの main ブランチとの差分を取得し、他のルールと組み合わせて使用します：

```
@ with-diff [対象ディレクトリやファイル（省略可）] @ [他のルール] [内容]
```

例：

- `@ with-diff @ create-docs @ of-api-design ユーザー認証APIの設計` - main ブランチとの差分を取得し、それを参考に API 設計書を作成
- `@ with-diff docs/web @ update-docs UIコンポーネントの標準化` - Web 関連ドキュメントの差分に基づいてドキュメントを更新
- `@ with-diff docs/api/1.structure @ review-docs API設計の一貫性確認` - API 構造関連の差分を取得し、設計の一貫性をレビュー

### 対象の指定

対象ディレクトリやファイルを指定することで、差分取得の範囲を限定できます：

- 指定なし: docs ディレクトリ全体
- ディレクトリ指定: `docs/api`のように特定のカテゴリ
- サブディレクトリ指定: `docs/api/1.structure`のように特定の構造
- ファイル指定: `docs/api/1.structure/auth-api.md`のように特定のファイル

### 他のルールとの連携

取得した差分情報は、以下のような他のルールと組み合わせて使用できます：

1. **create-docs**: 差分情報を参考に新しいドキュメントを作成


    ```
    @ with-diff @ create-docs @ of-detailed-requirements ユーザー認証の詳細要件
    ```

2. **update-docs**: 差分情報に基づいてドキュメントを更新


    ```
    @ with-diff docs/web @ update-docs ログイン画面の設計更新
    ```

3. **review-docs**: 差分情報を元にドキュメントをレビュー


    ```
    @ with-diff @ review-docs プロジェクト全体のドキュメント整合性確認
    ```

4. **of-〇〇-design**: 差分情報を特定の設計ドキュメントに反映


    ```
    @ with-diff docs/api @ create-docs @ of-api-design APIの設計改善
    ```

## 確認対象

- 要件定義書（簡易要件、詳細要件）
- 設計書（API 設計、Web 設計、インフラ設計）
- 手順書
- 技術文書

## レビューのポイント

- 新規要件が既存の設計と矛盾していないか
- 技術的な制約が適切に考慮されているか
- ドキュメント間の依存関係が明確か
- TOC が自動生成されているか
- Markdown の構造が適切か

## 差分確認の観点

### 1. 変更の特定

- **追加された内容**：新たに追加された記述や章節
- **削除された内容**：削除または省略された記述や章節
- **変更された内容**：修正や書き換えが行われた箇所

### 2. 変更の評価

- **一貫性**：変更によって文書内の一貫性が保たれているか
- **影響範囲**：変更が他の部分に影響を与えていないか
- **完全性**：必要な変更が漏れなく行われているか
- **根拠**：変更に妥当な理由があるか

## 差分確認レポートの構成テンプレート

```markdown
# 【ドキュメント名】差分確認レポート

## 1. 変更概要

[変更の全体像と目的]

## 2. 主要な変更点

| 箇所   | 変更タイプ     | 変更内容           | 評価               |
| ------ | -------------- | ------------------ | ------------------ |
| [章節] | 追加/削除/変更 | [具体的な変更内容] | 適切/要確認/要修正 |

## 3. 潜在的な問題点

[変更による影響や整合性の問題]

## 4. 推奨アクション

[問題解決や改善のための提案]
```

## 改善提案

- 不明確な要件や設計の特定
- より適切な代替案の提示
- ドキュメント構成の改善点の提案
- 他モジュールとの連携ポイントの明確化

## 差分確認のベストプラクティス

- バージョン管理システムの差分表示機能を活用する
- 大きな変更は概要から確認し、その後詳細を確認する
- 単純な表現の変更と内容の変更を区別する
- 変更の背景や理由を理解した上で評価する
- 差分だけでなく、文書全体の中での位置づけも考慮する

## 活用例

### 1. 差分に基づく要件更新

```
@ with-diff docs/api/1.structure @ create-docs @ of-detailed-requirements ユーザー認証API要件の更新
```

このコマンドは以下のステップで処理されます：

1. docs/api/1.structure ディレクトリの main ブランチとの差分を取得
2. 差分情報を分析し、要件への影響を特定
3. 詳細要件ドキュメントを更新して整合性を確保

### 2. 差分を反映した設計書改善

```
@ with-diff docs/web @ create-docs @ of-web-design UIコンポーネントの標準化
```

このコマンドは以下のように動作します：

1. docs/web ディレクトリの差分を確認
2. Web 関連の変更パターンを特定
3. 変更に基づいて UI コンポーネントの設計を標準化

### 3. 全体的な差分レビュー

```
@ with-diff @ review-docs プロジェクト全体のドキュメント整合性確認
```

このコマンドでは：

1. docs ディレクトリ全体の差分を取得
2. 差分を体系的にレビュー
3. ドキュメント間の整合性問題を指摘
