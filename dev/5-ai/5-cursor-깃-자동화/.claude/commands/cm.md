---
allowed-tools: Bash(pwd), Bash(git rev-parse:*), Bash(git status), Bash(git diff:*), Bash(git commit:*), Bash(git log:*), Bash(npm run format), Bash(gh pr view:*)
description: 現在の変更をコミットしてプッシュする
---

# Git コミット & プッシュ

現在の変更（未コミットの変更）からコミットを作成し、リモートにプッシュします。以下の手順に従ってください：

## 1. 作業ディレクトリと git ルートの確認

**重要**: git add でパスエラーを防ぐため、最初に現在の作業ディレクトリと git ルートを確認する：

```bash
# 現在のディレクトリを確認
pwd

# gitリポジトリのルートを確認
git rev-parse --show-toplevel
```

以降の git コマンドはすべて git リポジトリのルートからの相対パスで実行すること。

## 2. 差分の確認

以下のコマンドを実行して現在の差分を確認：

```bash
# gitステータスを確認
git status

# ステージング済みの差分を表示
git diff --cached

# 未ステージングの差分を表示
git diff

# 最近のコミットメッセージを確認（スタイル参考用）
git log --oneline -10
```

## 3. 事前チェック

続行する前に以下を確認：

- 変更が存在すること（ステージング済みまたは未ステージング）
- 変更がない場合はユーザーに通知して停止する
- main または master ブランチにいる場合は警告し、ブランチ作成を提案する

## 4. コードフォーマット

**重要**: コミット前に必ずフォーマットを実行：

```bash
npm run format
```

フォーマット後に新たな差分が発生した場合は、その変更も含めてコミットする。

## 5. 変更のステージング

コミットに含めるべきファイルのみを選択的にステージング：

```bash
git add 'ファイル1' 'ファイル2' ...
```

**重要 - 特殊文字のエスケープ:**
ファイル名やディレクトリ名に以下の特殊文字が含まれる場合は、**シングルクォートで囲む**か**バックスラッシュでエスケープ**する：

- `[` `]` (例: `[session_id]` → `'[session_id]'` または `\[session_id\]`)
- `(` `)` (例: `(entry)` → `'(entry)'` または `\(entry\)`)

**シングルクォートを使う方法を推奨**（確実で簡単）：

```bash
# 特殊文字を含むパスの例
git add 'src/components/[session_id]/page.tsx'
git add 'src/utils/(entry)/index.ts'
```

注意事項：

- **ユーザーが具体的なファイルを指定した場合は、そのファイルのみを add する**（余計な提案をしない）
- **`git add -A` や `git add .` は使用しない** - 常に個別ファイルを指定
- 一時ファイルや関係ない変更は含めない
- .env や credentials.json など機密情報を含むファイルはコミットしない
- **パスは必ず git リポジトリのルートからの相対パスを使用する**

## 6. コミットメッセージの作成

変更内容を分析し、適切なコミットメッセージを作成：

```bash
git commit -m "コミットメッセージ"
```

コミットメッセージのガイドライン：

- 日本語で記述する
- 簡潔に（50-70 文字程度）
- 「何を」ではなく「なぜ」に焦点を当てる
- 動詞で始める（追加、修正、更新、リファクタリング、削除 など）
- 関連する課題があれば #番号 で参照する

例：

- `Cognitoによるユーザー認証を追加`
- `面接回数制限のエッジケース処理を修正`
- `ジョブ設定用のデータベーススキーマを更新`
- `音声処理フックを再利用性向上のためリファクタリング`

## 7. コミット後の確認

```bash
git status
git log -1
```

## 8. リモートにプッシュ

```bash
git push origin $(git branch --show-current)
```

## 9. PR の表示

プッシュ完了後、現在のブランチに関連する PR を表示：

```bash
gh pr view $(git branch --show-current) --json url,title,state,number
```

PR が存在する場合は、タイトル、状態、URL をユーザーに報告する。

## ガイドライン

- コミットメッセージに共同著者表記やツール帰属を記載しない
- 1 つのコミットは 1 つの論理的な変更に限定する
- 大きな変更は複数の小さなコミットに分割することを検討する
- pre-commit フックでエラーが発生した場合は、問題を修正して新しいコミットを作成する（--amend は使用しない）

## 禁止事項

- `git add -A` または `git add .` の使用
- `git reset --hard` の使用
- `--no-verify` フラグの使用
- `git push --force` の使用
- main または master ブランチへの直接コミット（警告後にユーザーが明示的に許可した場合を除く）
