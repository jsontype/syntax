---
allowed-tools: Bash(pwd), Bash(git rev-parse:*), Bash(gh:*), Bash(git status), Bash(git diff:*), Bash(git checkout:*), Bash(git commit:*), Bash(git branch:*), Bash(git log:*)
description: 現在の差分からプルリクエストを作成する
---

# プルリクエスト作成

現在の差分（未コミットの変更）からプルリクエストを作成します。以下の手順に従ってください：

## 1. 作業ディレクトリと git ルートの確認

**重要**: git add でパスエラーを防ぐため、最初に現在の作業ディレクトリと git ルートを確認する：

```bash
# 現在のディレクトリを確認
pwd

# gitリポジトリのルートを確認
git rev-parse --show-toplevel
```

以降の git コマンドはすべて git リポジトリのルートからの相対パスで実行すること。

## 2. 差分の確認

以下のコマンドを実行して現在の差分を確認：

```bash
# gitステータスを確認
git status

# ステージング済みの差分を表示
git diff --cached

# 未ステージングの差分を表示
git diff
```

## 3. 事前チェック

続行する前に以下を確認：

- 変更が存在すること（ステージング済みまたは未ステージング）
- 変更がない場合はユーザーに通知して停止する

## 4. 新しいブランチを作成

変更内容に基づいて適切なブランチ名を決定し、新しいブランチを作成：

```bash
git checkout -b feature/適切なブランチ名
```

ブランチ名の規則：

- 機能追加: `feature/機能名`
- バグ修正: `fix/修正内容`
- リファクタリング: `refactor/対象`

## 5. 変更をコミット

PR に含めるべきファイルのみを選択的にステージング：

```bash
git add 'ファイル1' 'ファイル2' ...
git commit -m "コミットメッセージ"
```

**重要 - 特殊文字のエスケープ:**
ファイル名やディレクトリ名に以下の特殊文字が含まれる場合は、**シングルクォートで囲む**：

- `[` `]` (例: `[session_id]` → `'[session_id]'`)
- `(` `)` (例: `(entry)` → `'(entry)'`)

```bash
# 特殊文字を含むパスの例
git add 'src/components/[session_id]/page.tsx'
git add 'src/utils/(entry)/index.ts'
```

注意事項：

- 変更内容を確認し、PR に必要なファイルのみを add する
- 一時ファイルや関係ない変更は含めない
- コミットメッセージは変更内容を簡潔に説明する
- **パスは必ず git リポジトリのルートからの相対パスを使用する**

## 6. リモートにプッシュ

```bash
git push -u origin $(git branch --show-current)
```

## 7. プルリクエストの作成

まず`.github/pull_request_template.md`を読み込み、テンプレートの構造を確認する。

テンプレートの各セクションに対して、今回の変更内容に基づいて適切な内容を記述し、gh CLI で PR を作成：

```bash
gh pr create --draft --title "PRタイトル" --body "テンプレートに沿った内容"
```

- テンプレートのセクション構造に従う
- 各セクションに適切な内容を埋める
- 該当しないセクションは空欄または「なし」と記載
- タイトルと本文は全て日本語で記載する

## 8. 作成後

PR 作成後：

- PR URL を表示する

## ガイドライン

- タイトルは簡潔に（50-70 文字）
- 説明では「何を」ではなく「なぜ」に焦点を当てる
- 関連する課題があれば #番号 で参照する
- 常に `--draft` フラグを使用してドラフトとして作成する
- コミットやプルリクエストに共同著者表記やツール帰属を記載しない
