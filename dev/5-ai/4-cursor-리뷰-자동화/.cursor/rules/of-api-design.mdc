---
description: API設計: API仕様やアーキテクチャの設計ドキュメント作成支援ルール
globs: docs/api/**
---

# API 設計ドキュメント作成ガイド

API サービスの設計に関する文書を作成・更新するためのガイドラインです。API 仕様、エンドポイント定義、データモデル、認証方式などを体系的に文書化します。

## 使用方法

このルールは以下のような形式で呼び出します：

```
@ create-docs @ of-api-design [APIの名前や機能]
```

例：

- `@ create-docs @ of-api-design ユーザー認証API` - ユーザー認証 API の設計書を作成
- `@ create-docs @ of-api-design ライブストリーミングAPI` - ライブ配信機能の API 設計書を作成
- `@ create-docs @ of-api-design チャットメッセージングAPI` - チャット機能の API 設計書を作成

with-diff ルールと組み合わせることで、既存の API 設計との差分を明確にできます：

```
@ create-docs @ of-api-design @ with-diff [API変更内容]
```

例：

- `@ create-docs @ of-api-design @ with-diff 認証APIのOAuth2.0対応` - 認証 API の更新内容を差分で確認
- `@ create-docs @ of-api-design @ with-diff ユーザーAPIへのプロフィール項目追加` - ユーザー API 変更の差分確認

他の設計書との連携も可能です：

```
@ create-docs @ of-api-design @ of-web-design [連携機能]
```

例：

- `@ create-docs @ of-api-design @ of-web-design チャット機能の統合設計` - API と Web フロントエンドの連携設計

## ドキュメント保存先

API 設計ドキュメントは、内容に応じて以下のフォルダに保存します：

- 要件定義・アーキテクチャ：`docs/api/1.structure/`
- 初期設定・手順：`docs/api/2.initial/`
- 必要に応じて追加カテゴリ：`docs/api/3.<カテゴリ名>/`

## API 設計ドキュメントの構成テンプレート

````markdown
# 【API 名】設計仕様書

## 1. 概要

[API の目的と概要]

## 2. 基本情報

- ベース URL: `https://api.example.com/v1/`
- プロトコル: HTTPS
- データフォーマット: JSON
- 文字エンコーディング: UTF-8

## 3. 認証・認可

- 認証方式
- 認可方式
- セキュリティ要件

## 4. エンドポイント一覧

| メソッド | パス       | 説明             | 認証要否  |
| -------- | ---------- | ---------------- | --------- |
| GET      | /resources | リソース一覧取得 | 必要/不要 |
| POST     | /resources | リソース作成     | 必要/不要 |

## 5. 詳細 API 仕様

### 5.1. リソース一覧取得

#### リクエスト

- メソッド: GET
- パス: /resources
- クエリパラメータ:
  - `limit`: 取得件数上限（任意、デフォルト 20）
  - `offset`: 取得開始位置（任意、デフォルト 0）

#### レスポンス

- 成功時 (200 OK):

```json
{
  "data": [
    {
      "id": "string",
      "name": "string",
      "created_at": "datetime"
    }
  ],
  "meta": {
    "total": "number",
    "limit": "number",
    "offset": "number"
  }
}
```
````

- エラー時:
  - 400 Bad Request: パラメータ不正
  - 401 Unauthorized: 認証エラー
  - 403 Forbidden: 権限エラー
  - 500 Internal Server Error: サーバーエラー

## 6. データモデル

[主要なリソースのデータ構造を定義]

## 7. エラーハンドリング

- エラーレスポンス形式
- エラーコード一覧

## 8. 非機能要件

- レート制限
- パフォーマンス基準
- 可用性要件

## 9. その他考慮事項

- バージョニング戦略
- 後方互換性の方針
- 運用監視方法

```

## API設計ドキュメント作成のポイント

- **一貫性のある命名規則**：URI、パラメータ、属性名などに一貫した命名規則を適用
- **RESTful原則の遵守**：リソース指向の設計、適切なHTTPメソッドの使用
- **詳細なエラー情報**：エラー状況を明確に伝えるレスポンス設計
- **バージョニング考慮**：APIの進化に対応できる設計
- **セキュリティ配慮**：認証、認可、データ保護の考慮
- **開発者体験**：APIを利用する開発者にとって使いやすい設計

## ユーザーとのインタラクション

API設計を作成する過程では、仕様を明確にするために、ユーザー（依頼者/ステークホルダー）に対して適切な質問を行うことが重要です。必要な情報を文脈に応じて収集してください。

### 質問すべき重要事項

1. **API全体設計**
   - このAPIは誰が利用しますか？（フロントエンド開発者、サードパーティ開発者、特定の内部システムなど）
   - APIの公開範囲はどのようになりますか？（内部利用のみ、特定パートナー向け、完全公開など）
   - ドメインモデルやビジネスエンティティの関係性はどうなっていますか？
   - 期待されるトラフィック量やスケーリング要件はありますか？

2. **リソースと操作**
   - 主要なリソース（エンティティ）にはどのようなものがありますか？
   - 各リソースでどのような操作（CRUD操作など）が必要ですか？
   - リソース間の関連性をAPIでどのように表現しますか？（ネストされたリソース、関連ID参照など）
   - バッチ操作やトランザクション要件はありますか？

3. **データモデル**
   - 各リソースの属性にはどのような項目が必要ですか？
   - 必須項目と任意項目の区分けはどうなりますか？
   - データの型や制約条件（バリデーションルール）はどのようなものですか？
   - データの量とページネーション要件はどうあるべきですか？

4. **認証と認可**
   - どのような認証方式が適切ですか？（APIキー、OAuth、JWTなど）
   - 認可要件はどのようなものですか？（ロールベース、リソースベースなど）
   - 外部認証サービスとの連携は必要ですか？
   - APIキーのローテーションポリシーや有効期限はどうあるべきですか？

5. **エラーハンドリングとロギング**
   - どのようなエラーシナリオが考えられますか？
   - エラーレスポンスはどのような形式にすべきですか？
   - ロギングやモニタリングの要件はありますか？
   - デバッグ情報や詳細なエラー情報の公開ポリシーはどうあるべきですか？

6. **パフォーマンスと制約**
   - レスポンス時間の目標値はありますか？
   - レート制限や使用量制限を設けるべきですか？
   - キャッシュ戦略はどうあるべきですか？
   - 長時間実行処理やバックグラウンドジョブの扱いはどうしますか？

7. **バージョニングと進化**
   - APIのバージョニング戦略はどうあるべきですか？（URLパス、ヘッダー、パラメータなど）
   - 既存クライアントへの後方互換性はどの程度重視すべきですか？
   - 非推奨化ポリシーはどうあるべきですか？
   - 定期的なリリースサイクルはどうなりますか？

### 質問のベストプラクティス

- **ユースケースの特定**：「このAPIを使ってどのようなことを実現したいですか？」など、具体的なユースケースを引き出す
- **技術的な選択肢の提示**：REST、GraphQL、gRPCなど、異なるアプローチのメリット・デメリットを説明し意見を求める
- **既存システムとの整合性**：「既存のAPIやシステムとの連携はどうあるべきですか？」など、全体アーキテクチャの視点を持つ
- **優先順位の確認**：「初期リリースに最低限必要なエンドポイントはどれですか？」など、段階的実装のための情報を収集
- **制約条件の特定**：「セキュリティ上の制約や規制上の要件はありますか？」など、設計上の制約を明確にする

設計プロセスを通じて、これらの質問を適切なタイミングで行い、要件と技術的な実現可能性のバランスを取りながら設計を進めてください。---
alwaysApply: true
---
```
