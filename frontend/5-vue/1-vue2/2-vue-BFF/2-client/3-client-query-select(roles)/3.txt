[Roles ì¡°íšŒí•˜ê¸° : Apollo Client ì„¤ì •í•˜ê³  ì‹œì‘]

1. ì‚¬ì „ì¤€ë¹„ : server ì•±ì„ ì¼œë‘”ë‹¤.
1. ì‚¬ì „ì¤€ë¹„ : í”„ë¡œì íŠ¸ë¥¼ ìƒˆë¡œ ê¹”ì§€ ì•Šê³ , ì´ì „ ì±•í„°ì—ì„œì˜ ì½”ë“œë¥¼ ê·¸ëŒ€ë¡œ ì¹´í”¼í•´ì„œ ê°€ì§€ê³  ì˜¨ë‹¤.

1. Apollo Clientë€?
  Apollo Serverì™€ Reactë¥¼ ì—°ê²°í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ì´ë‹¤.
  ì´ê²ƒì„ í†µí•´ì„œ BFF Serverì™€ ì—°ê²°ì„ ì‹œí‚¬ ìˆ˜ ìˆê³ , GraphQLì„ í†µí•´ DBì— ì ‘ê·¼í•  ìˆ˜ ìˆê²Œ í•´ì¤€ë‹¤.

1. ì„¤ì¹˜
  $ cd app1
  $ npm install @apollo/client graphql



1. src/App.js ìˆ˜ì • : ApolloServerì™€ ì—°ê²°í•˜ê¸° ìœ„í•´, ApolloClient ê°ì²´ë¥¼ ë§Œë“  ë’¤, ApolloProvider íƒœê·¸ë¡œ DOMì„ ê°ì‹¸ì£¼ê¸°
  import "./App.css"
  import React, { useState } from "react"
  // ApolloClient ëª¨ë“ˆ ì„í¬íŠ¸
  import { ApolloProvider } from "@apollo/client"
  import { ApolloClient, InMemoryCache } from "@apollo/client"

  import Roles from "./components/roles"
  import Teams from "./components/teams"
  import People from "./components/people"

  // client : GraphQL ì„œë²„ë¡œì™€ ì •ë³´ë¥¼ ì£¼ê³ ë°›ì„ ApolloClient ê°ì²´
  const client = new ApolloClient({
    // uri : GraphQL ì„œë²„ì˜ ì£¼ì†Œ
    uri: "http://localhost:4000",
    // cache : InMemoryCacheë¥¼ í†µí•œ ìºì‹œ ê´€ë¦¬
    cache: new InMemoryCache(),
  })

  export default function App() {
    const [menu, setMenu] = useState("Roles")

    // mainComp : App-header ì•„ë˜ ë©”ì¸ í™”ë©´ì— ë‚˜íƒ€ë‚  ì»´í¬ë„ŒíŠ¸ ë§¤í•‘
    const mainComp = {
      Roles: <Roles />,
      Teams: <Teams />,
      People: <People />,
    }

    // NavMenus : menuê°’ì— ë”°ë¼ ìƒë‹¨ App-headerì˜ ë²„íŠ¼ì„ í‘œì‹œí•˜ëŠ” í•¨ìˆ˜
    function NavMenus() {
      return ["Roles", "Teams", "People"].map((_menu, key) => {
        return (
          <li
            key={key}
            className={menu === _menu ? "on" : ""}
            onClick={() => {
              setMenu(_menu)
            }}
          >
            {_menu}
          </li>
        )
      })
    }

    return (
      <div className="App">
        {/* ìµœìƒìœ„ divì•ˆì˜ ë‚´ë¶€ ìš”ì†Œë“¤ì„ ëª¨ë‘ ApolloProviderë¡œ ê°ì‹¸ì¤€ë‹¤. */}
        <ApolloProvider client={client}>
          <header className="App-header">
            <h1>Company Management</h1>
            <nav>
              <ul>{NavMenus()}</ul>
            </nav>
          </header>
          <main>{mainComp[menu]}</main>
        </ApolloProvider>
      </div>
    )
  }



1. src/components/roles.js ìˆ˜ì • : GraphQL ì„œë²„ë¡œë¶€í„° ëª©ë¡ ë°›ì•„ì™€ í‘œì‹œí•˜ê¸° ìœ„í•œ ì¤€ë¹„í•˜ê¸°
  import "./components.css"
  import { useState } from "react"
  import { useQuery, gql } from "@apollo/client"

  // GraphQL ì„œë²„ë¡œë¶€í„° ëª¨ë“  ì»¨í…ì¸ ë¥¼ í‘œì‹œí•˜ê¸° ìœ„í•œ ì¿¼ë¦¬
  const GET_ROLES = gql`
    query GetRoles {
      roles {
        id
      }
    }
  `

  // GraphQL ì„œë²„ë¡œë¶€í„° idì— í•´ë‹¹í•˜ëŠ” ì»¨í…ì¸  í•˜ë‚˜ë§Œ ë°›ì•„ì™€ì„œ í‘œì‹œí•˜ê¸° ìœ„í•œ ì¿¼ë¦¬
  const GET_ROLE = gql`
    query GetRole($id: ID!) {
      role(id: $id) {
        id
        requirement
        members {
          id
          last_name
          serve_years
        }
        equipments {
          id
        }
        softwares {
          id
        }
      }
    }
  `

  export default function Roles() {
    const [contentId, setContentId] = useState("")

    // ì™¼ìª½ ì‚¬ì´ë“œë°” : GraphQLë¡œë¶€í„° ëª¨ë“  ë°ì´í„°ë¥¼ ë°›ì•„ì™€ ëª©ë¡ì„ ë Œë”ë§í•˜ë„ë¡ ì‘ì„±
    function AsideItems() {
      const roleIcons = {
        developer: "ğŸ’»",
        designer: "ğŸ¨",
        planner: "ğŸ“",
      }
      const { loading, error, data } = useQuery(GET_ROLES)

      if (loading) return <p className="loading">Loading...</p>
      if (error) return <p className="error">Error :(</p>
      // GET_ROLES ì¿¼ë¦¬ ì‘ë‹µì„ ì½˜ì†”ë¡œê·¸ì— ì°ëŠ”ë‹¤.
      if (data) {
        console.log("GET_ROLES ì¿¼ë¦¬ ì‘ë‹µ: ", data)
      }

      return (
        <ul>
          {data.roles.map(({ id }) => {
            return (
              <li
                key={id}
                className={"roleItem " + (contentId === "id" ? "on" : "")}
                onClick={() => {
                  setContentId(id)
                }}
              >
                <span>{contentId === id ? "ğŸ”²" : "â¬›"}</span>
                {roleIcons[id]} {id}
              </li>
            )
          })}
        </ul>
      )
    }

    // ê°€ìš´ë° ë©”ì¸ì»¨í…ì¸  : GraphQL ì„œë²„ë¡œë¶€í„° idë¡œ í•œê°œì˜ ì»¨í…ì¸  ë°›ì•„ì™€ í‘œì‹œí•˜ê¸°
    function MainContents() {
      const { loading, error, data } = useQuery(GET_ROLE, {
        variables: { id: contentId },
      })

      if (loading) return <p className="loading">Loading...</p>
      if (error) return <p className="error">Error :(</p>
      if (contentId === "") return <div className="roleWrapper">Select Role</div>
      // GET_ROLE ì¿¼ë¦¬ ì‘ë‹µì„ ì½˜ì†”ë¡œê·¸ì— ì°ëŠ”ë‹¤.
      if (data) {
        console.log("GET_ROLE ì¿¼ë¦¬ ì‘ë‹µ: ", data)
      }

      return (
        <div className="roleWrapper">
          <h2>{data.role.id}</h2>
          <div className="requirement">
            <span>{data.role.requirement}</span> required
          </div>
          <h3>Members</h3>
          <ul>
            {data.role.members.map((member) => {
              return <li key={member.id}>{member.last_name}</li>
            })}
          </ul>
          <h3>Equipments</h3>
          <ul>
            {data.role.equipments.map((equipment) => {
              return <li key={equipment.id}>{equipment.id}</li>
            })}
          </ul>
          <h3>Softwares</h3>
          {data.role.softwares.map((software) => {
            return <li key={software.id}>{software.id}</li>
          })}
          <ul></ul>
        </div>
      )
    }

    return (
      <div id="roles" className="component">
        <aside>{AsideItems()}</aside>
        <section className="contents">{MainContents()}</section>
      </div>
    )
  }



1. í…ŒìŠ¤íŠ¸ : Roles í™”ë©´ì—ì„œ ì‚¬ì´ë“œë°”ì™€ ì»¨í…ì¸  ë¶€ë¶„ì´ ì˜ í‘œì‹œë˜ëŠ”ì§€ í™•ì¸
  $ cd app1
  $ npm start
  http://localhost:3000
  ìƒë‹¨ì˜ Roles ë©”ë‰´ í´ë¦­
  ì‚¬ì´ë“œë°”ì™€ ì»¨í…ì¸  ë¶€ë¶„ì´ ì˜ í‘œì‹œë˜ëŠ”ì§€ í™•ì¸



1. íŠ¸ëŸ¬ë¸”ìŠˆíŒ… : Failed to parse source map from ... @wry\context\src\index.ts ì—ëŸ¬ê°€ ë°œìƒí•  ê²½ìš°
  ì›ì¸ : Webpack 5.xì˜ CRA ëª…ë ¹ì–´ê°€ ì›ì¸ì´ë‹¤.

  í•´ê²°ë°©ë²•1 : 
    ë£¨íŠ¸í´ë”(app1)ì— .env íŒŒì¼ì„ ë§Œë“ ë‹¤.
    .env íŒŒì¼ì— ë‹¤ìŒ ì½”ë“œë¥¼ ë„£ëŠ”ë‹¤.
      GENERATE_SOURCEMAP=false
    ì¬ê¸°ë™í•˜ë©´ ì—ëŸ¬ê°€ ë‚˜ì§€ ì•ŠëŠ”ë‹¤.

  í•´ê²°ë°©ë²•2 :
    sourcemapì„ ë¡œì»¬ì—ì„œë§Œ ë¹„í™œì„±í™”í•˜ë ¤ë©´ package.jsonì˜ ìŠ¤í¬ë¦½íŠ¸ ë¶€ë¶„ì„ ì•„ë˜ì™€ ê°™ì´ ìˆ˜ì •í•´ë„ ëœë‹¤.
      "scripts": { "start": "GENERATE_SOURCEMAP=false && react-scripts start" }
