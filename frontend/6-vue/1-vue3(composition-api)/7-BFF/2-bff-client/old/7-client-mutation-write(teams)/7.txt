[í•­ëª© ì¶”ê°€í•˜ê¸°]

1. ì‚¬ì „ì¤€ë¹„: server ì•±ì„ ì¼œë‘”ë‹¤.
1. ì‚¬ì „ì¤€ë¹„: í”„ë¡œì íŠ¸ë¥¼ ìƒˆë¡œ ê¹”ì§€ ì•Šê³ , ì´ì „ ì±•í„°ì—ì„œì˜ ì½”ë“œë¥¼ ê·¸ëŒ€ë¡œ ì¹´í”¼í•´ì„œ ê°€ì§€ê³  ì˜¨ë‹¤.



1. src/views/Teams.vue ìˆ˜ì • : GraphQL ì„œë²„ë¡œ ì»¨í…ì¸  í•˜ë‚˜ë¥¼ ì¶”ê°€í•˜ëŠ” ê¸°ëŠ¥ ì¶”ê°€
  <template>
    <div id="teams" class="component">
      <aside>
        <ApolloQuery :query="GET_TEAMS">
          <template slot-scope="{ result: { loading, error, data } }">
            <p v-if="loading" class="loading">Loading...</p>
            <p v-if="error" class="error">Error :(</p>
            <aside v-else>
              <ul>
                <li v-for="team in data.teams" :key="team.id">
                  <span class="teamItemTitle" @click="selectTeam(team.id)">Team {{team.id}} : {{team.manager}}'s</span>
                  <ul class="teamMembers">
                    <li v-for="member in team.members" :key="member.id">
                      {{roleIcons[member.role]}} {{member.first_name}} {{member.last_name}}
                    </li>
                  </ul>
                </li>
              </ul>
            </aside>
          </template>
        </ApolloQuery>
      </aside>
      <section class="contents">
        <div v-if="selectedTeam" class="inputContainer">
          <table>
            <tr v-if="contentId !== 0">
              <td>Id</td>
              <td>{{contentId}}</td>
            </tr>      
            <input type="hidden" name="id" v-model="inputs.id">
            <tr>
              <td>Manager</td>
              <td>
                <input type="text" name="manager" v-model="inputs.manager">
              </td>
            </tr>
            <tr>
              <td>Office</td>
              <td>
                <input type="text" name="office" v-model="inputs.office">
              </td>
            </tr>
            <tr>
              <td>Extension Number</td>
              <td>
                <input type="text" name="extension_number" v-model="inputs.extension_number">
              </td>
            </tr>
            <tr>
              <td>Mascot</td>
              <td>
                <input type="text" name="mascot" v-model="inputs.mascot">
              </td>
            </tr>
            <tr>
              <td>Cleaning Duty</td>
              <td>
                <input type="text" name="cleaning_duty" v-model="inputs.cleaning_duty">
              </td>
            </tr>
            <tr>
              <td>Project</td>
              <td>
                <input type="text" name="project" v-model="inputs.project">
              </td>
            </tr>
          </table>
            <div class="buttons" v-if="contentId === 0">
              <button v-on:click="postTeam()">Submit</button>
            </div>
            <div class="buttons" v-else>
              <button v-on:click="editTeam(contentId)">Modify</button>
              <button v-on:click="deleteTeam(contentId)">Delete</button>
              <button v-on:click="resetContentId">New</button>
            </div>        
        </div>
      </section>
    </div>
  </template>

  <script>
  import { ApolloProvider } from 'vue-apollo'
  import ApolloClient from 'apollo-boost'
  import gql from 'graphql-tag'

  const client = new ApolloClient({
    uri: 'http://localhost:4000/', // GraphQL Server URL
  })

  const GET_TEAMS = gql`
    query GetTeams {
      teams {
        id
        manager
        members {
          id
          first_name
          last_name
          role
        }
      }
    }
  `

  const GET_TEAM = gql`
    query GetTeam($id: ID!) {
      team(id: $id) {
        id
        manager
        office
        extension_number
        mascot
        cleaning_duty
        project
      }
    }
  `

  const DELETE_TEAM = gql`
    mutation DeleteTeam($id: ID!) {
      deleteTeam(id: $id) {
        id
      }
    }
  `

  const EDIT_TEAM = gql`
    mutation EditTeam($id: ID!, $input: PostTeamInput!) {
      editTeam(id: $id, input: $input) {
        id
        manager
        office
        extension_number
        mascot
        cleaning_duty
        project
      }
    }
  `

  const POST_TEAM = gql`
    mutation PostTeam($input: PostTeamInput!) {
      postTeam(input: $input) {
        id
        manager
        office
        extension_number
        mascot
        cleaning_duty
        project
      }
    }
  `

  export default {
    provide: () => ({
      apolloProvider: new ApolloProvider({ defaultClient: client }),
    }),
    data () {
      return {
        contentId: 0,
        inputs: {
          manager: "",
          office: "",
          extension_number: "",
          mascot: "",
          cleaning_duty: "",
          project: "",
        },
        roleIcons: {
          developer: "ğŸ’»",
          designer: "ğŸ¨",
          planner: "ğŸ“",
        },
        selectedTeam: null,
        GET_TEAMS,
        GET_TEAM,
        DELETE_TEAM,
        EDIT_TEAM,
        POST_TEAM,
      }
    },
    methods: {
      async selectTeam (id) {
        this.contentId = id
        const { data } = await this.$apollo.query({ query: this.GET_TEAM, variables: { id } })
        this.selectedTeam = data.team
        this.inputs = {
          manager: data.team.manager,
          office: data.team.office,
          extension_number: data.team.extension_number,
          mascot: data.team.mascot,
          cleaning_duty: data.team.cleaning_duty,
          project: data.team.project,
        }
      },
      resetContentId() {
        this.contentId = 0
        this.inputs = {
          manager: "",
          office: "",
          extension_number: "",
          mascot: "",
          cleaning_duty: "",
          project: "",
        }
      },
      async deleteTeam (id) {
        if (window.confirm('ì´ í•­ëª©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
          await this.$apollo.mutate({ 
            mutation: this.DELETE_TEAM, 
            variables: { id },
            refetchQueries: [{ query: this.GET_TEAMS }] // ì‚­ì œ í›„ íŒ€ ëª©ë¡ì„ ì—…ë°ì´íŠ¸
          })
          this.resetContentId() // ì‚­ì œ í›„ ì…ë ¥ í•„ë“œë¥¼ ì´ˆê¸°í™”
        }
      },
      async editTeam (id) {
        console.log(this.inputs)
        await this.$apollo.mutate({ 
          mutation: this.EDIT_TEAM,
          variables: {
            id,
            input: this.inputs
          },
          refetchQueries: [{ query: this.GET_TEAMS }] // ìˆ˜ì • í›„ íŒ€ ëª©ë¡ì„ ì—…ë°ì´íŠ¸
        })
        alert(`${id} í•­ëª©ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.`)
      },
      async postTeam () {
        const response = await this.$apollo.mutate({ // response ê°ì²´ì˜ data í”„ë¡œí¼í‹°ì— mutationì˜ ê²°ê³¼ë¥¼ ë‹´ê¸°
          mutation: this.POST_TEAM,
          variables: {
            input: this.inputs
          },
          refetchQueries: [{ query: this.GET_TEAMS }] // ì¶”ê°€ í›„ íŒ€ ëª©ë¡ì„ ì—…ë°ì´íŠ¸
        })
        console.log(response.data.postTeam.id)
        alert(`${response.data.postTeam.id} í•­ëª©ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.`)
        this.resetContentId() // ì¶”ê°€ í›„ ì…ë ¥ í•„ë“œë¥¼ ì´ˆê¸°í™”
      }
    },
    created() {
      this.resetContentId(); // ì´ˆê¸°í™”ë©´ êµ¬ë™ì‹œ, ì…ë ¥ í•„ë“œë¥¼ ì´ˆê¸°í™”
      this.selectedTeam = {}; // ì´ˆê¸°í™”ë©´ êµ¬ë™ì‹œ, selectedTeamì„ ë¹ˆ ê°ì²´ë¡œ ì´ˆê¸°í™”
    },
  }
  </script>



1. í…ŒìŠ¤íŠ¸ : Teams í™”ë©´ì—ì„œ ì¶”ê°€ ë²„íŠ¼ì„ ëˆ„ë¥¸ ë’¤ ë°˜ì˜ê¹Œì§€ ì˜ ë˜ë‚˜ í™•ì¸
  BFF server ì•± ì¼œì ¸ìˆëŠ”ì§€ í™•ì¸í•˜ê³ , êº¼ì ¸ìˆë‹¤ë©´ npm startë¡œ ì‹¤í–‰ì‹œì¼œë‘ê³  ì‹œì‘í•œë‹¤.
  $ cd app1
  $ npm run serve
  http://localhost:8080
  ìƒë‹¨ì˜ Teams ë©”ë‰´ í´ë¦­
  Team 1 : Mandy Warren's í´ë¦­í•´ì„œ, ì»¨í…ì¸  ì¸í’‹ì— íŒ€ ì •ë³´ë¡œ ì±„ì›Œì§€ë‚˜ í™•ì¸
  New ë²„íŠ¼ì„ ëˆŒëŸ¬ë³´ê¸° (* Teamsì˜ ì´ˆê¸° í™”ë©´ì´ New ëˆŒë €ì„ ë•Œì™€ ê°™ìŒ)
  ë‚´ìš©ì„ ì…ë ¥ í›„ Submit ë²„íŠ¼ì„ ëˆŒëŸ¬ë³´ê¸°
  ì¸í’‹ì°½ ë‚´ìš©ìœ¼ë¡œ ì»¨í…ì¸ ê°€ ì¶”ê°€ëœ ê²ƒì´ ë©”ì¸ì»¨í…ì¸ ì™€ ì‚¬ì´ë“œë°”ì—ì„œ ë°˜ì˜ë˜ëŠ”ì§€ í™•ì¸  
