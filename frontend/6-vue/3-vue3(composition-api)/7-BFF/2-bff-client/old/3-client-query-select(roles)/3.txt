[Roles ì¡°íšŒí•˜ê¸° : Apollo Client ì„¤ì •í•˜ê³  ì‹œì‘]

1. ì‚¬ì „ì¤€ë¹„: server ì•±ì„ ì¼œë‘”ë‹¤.
1. ì‚¬ì „ì¤€ë¹„: í”„ë¡œì íŠ¸ë¥¼ ìƒˆë¡œ ê¹”ì§€ ì•Šê³ , ì´ì „ ì±•í„°ì—ì„œì˜ ì½”ë“œë¥¼ ê·¸ëŒ€ë¡œ ì¹´í”¼í•´ì„œ ê°€ì§€ê³  ì˜¨ë‹¤.

1. Apollo Clientë€?
  Apollo Serverì™€ í´ë¼ì´ì–¸íŠ¸ë¥¼ ì—°ê²°í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ì´ë‹¤.
  ì´ê²ƒì„ í†µí•´ì„œ BFF Serverì™€ ì—°ê²°ì„ ì‹œí‚¬ ìˆ˜ ìˆê³ , GraphQLì„ í†µí•´ DBì— ì ‘ê·¼í•  ìˆ˜ ìˆê²Œ í•´ì¤€ë‹¤.

1. ì„¤ì¹˜
  $ cd app1
  $ npm install vue-apollo apollo-boost graphql-tag



1. src/main.js ìˆ˜ì • : ApolloServerì™€ ì—°ê²°í•˜ê¸° ìœ„í•´, ApolloClient ê°ì²´ë¥¼ ë§Œë“  ë’¤, ApolloProviderë¥¼ Appì— ì œê³µí•˜ê¸°
  import Vue from "vue"
  import App from "./App.vue"
  import router from "./router"
  import store from "./store"

  // BFF
  import { ApolloClient } from "apollo-client"
  import { HttpLink } from "apollo-link-http"
  import { InMemoryCache } from "apollo-cache-inmemory"
  import VueApollo from "vue-apollo"

  Vue.use(VueApollo)

  // GraphQL ì„œë²„ì˜ URL ì§€ì •
  const httpLink = new HttpLink({
    uri: "http://localhost:4000/",
  })

  // Apollo client ìƒì„±
  const apolloClient = new ApolloClient({
    link: httpLink,
    cache: new InMemoryCache(),
  })

  // Apollo provider ìƒì„±
  const apolloProvider = new VueApollo({
    defaultClient: apolloClient,
  })

  Vue.config.productionTip = false

  new Vue({
    router,
    store,
    provide: apolloProvider.provide(),
    render: (h) => h(App),
  }).$mount("#app")



1. src/views/Roles.vue ìˆ˜ì • : GraphQL ì„œë²„ë¡œë¶€í„° ëª©ë¡ ë°›ì•„ì™€ í‘œì‹œí•˜ê¸° ìœ„í•œ ì¤€ë¹„í•˜ê¸°
  <template>
    <div id="roles" class="component">
      <aside>
        <ul>
          <li
            v-for="role in roles"
            :key="role.id"
            :class="['roleItem', contentId === role.id ? 'on' : '']"
            @click="selectRole(role.id)"
          >
            <span>{{ contentId === role.id ? "ğŸ”²" : "â¬›" }}</span>{{ roleIcons[role.id] }} {{ role.id }}
          </li>
        </ul>
      </aside>
      <section class="contents">
        <div v-if="loading" class="loading">Loading...</div>
        <div v-if="error" class="error">Error :(</div>
        <div v-else-if="selectedRole" class="roleWrapper">
          <h2>{{ selectedRole.id }}</h2>
          <div class="requirement">
            <span>{{ selectedRole.requirement }}</span> required
          </div>
          <h3>Members</h3>
          <ul>
            <li v-for="member in selectedRole.members" :key="member.id">
              {{ member.last_name }}
            </li>
          </ul>
          <h3>Equipments</h3>
          <ul>
            <li v-for="equipment in selectedRole.equipments" :key="equipment.id">
              {{ equipment.id }}
            </li>
          </ul>
          <h3>Softwares</h3>
          <ul>
            <li v-for="software in selectedRole.softwares" :key="software.id">
              {{ software.id }}
            </li>
          </ul>
        </div>
        <div v-else class="roleWrapper">Select Role</div>
      </section>
    </div>
  </template>

  <script>
  import ApolloClient from "apollo-boost"
  import gql from "graphql-tag"

  const client = new ApolloClient({
    uri: "http://localhost:4000/", // GraphQL API ì£¼ì†Œ
  })

  const GET_ROLES = gql`
    query GetRoles {
      roles {
        id
      }
    }
  `

  const GET_ROLE = gql`
    query GetRole($id: ID!) {
      role(id: $id) {
        id
        requirement
        members {
          id
          last_name
        }
        equipments {
          id
        }
        softwares {
          id
        }
      }
    }
  `

  export default {
    data() {
      return {
        contentId: null,
        loading: false,
        error: null,
        roles: [],
        selectedRole: null,
        roleIcons: {
          developer: "ğŸ’»",
          designer: "ğŸ¨",
          planner: "ğŸ“",
        },
      }
    },
    created() {
      this.loadRoles()
    },
    methods: {
      async loadRoles() {
        this.loading = true
        try {
          const { data } = await client.query({ query: GET_ROLES })
          this.roles = data.roles
        } catch (error) {
          this.error = error
        } finally {
          this.loading = false
        }
      },
      async selectRole(id) {
        this.contentId = id
        this.loading = true
        try {
          const { data } = await client.query({
            query: GET_ROLE,
            variables: { id },
          })
          this.selectedRole = data.role
        } catch (error) {
          this.error = error
        } finally {
          this.loading = false
        }
      },
    },
  }
  </script>



1. í…ŒìŠ¤íŠ¸ : Roles í™”ë©´ì—ì„œ ì‚¬ì´ë“œë°”ì™€ ì»¨í…ì¸  ë¶€ë¶„ì´ ì˜ í‘œì‹œë˜ëŠ”ì§€ í™•ì¸
  BFF server ì•± ì¼œì ¸ìˆëŠ”ì§€ í™•ì¸í•˜ê³ , êº¼ì ¸ìˆë‹¤ë©´ npm startë¡œ ì‹¤í–‰ì‹œì¼œë‘ê³  ì‹œì‘í•œë‹¤.
  $ cd app1
  $ npm start
  http://localhost:8080
  ìƒë‹¨ì˜ Roles ë©”ë‰´ í´ë¦­
  ì‚¬ì´ë“œë°”ì™€ ì»¨í…ì¸  ë¶€ë¶„ì´ ì˜ í‘œì‹œë˜ëŠ”ì§€ í™•ì¸
