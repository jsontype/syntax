[í•­ëª© ì¡°íšŒ, ì‚­ì œ, ìˆ˜ì •, ì¶”ê°€ ê¸°ëŠ¥ì„ people ì»´í¬ë„ŒíŠ¸ì— í•œë²ˆì— ì ìš©í•˜ê¸°]

1. ì‚¬ì „ì¤€ë¹„: server ì•±ì„ ì¼œë‘”ë‹¤.
1. ì‚¬ì „ì¤€ë¹„: í”„ë¡œì íŠ¸ë¥¼ ìƒˆë¡œ ê¹”ì§€ ì•Šê³ , ì´ì „ ì±•í„°ì—ì„œì˜ ì½”ë“œë¥¼ ê·¸ëŒ€ë¡œ ì¹´í”¼í•´ì„œ ê°€ì§€ê³  ì˜¨ë‹¤.



1. src/views/People.vue ìˆ˜ì • : í•­ëª© ì¡°íšŒ, ì‚­ì œ, ìˆ˜ì •, ì¶”ê°€ ê¸°ëŠ¥ì„ people ì»´í¬ë„ŒíŠ¸ì— í•œë²ˆì— ì ìš©í•˜ê¸°
  <template>
    <div id="people" class="component">
      <aside>
        <ApolloQuery :query="GET_PEOPLE">
          <template slot-scope="{ result: { loading, error, data } }">
            <p v-if="loading" class="loading">Loading...</p>
            <p v-if="error" class="error">Error :(</p>
            <aside v-else>
              <ul v-if="data && data.people">
                <li v-for="person in data.people" :key="person.id" @click="selectPerson(person.id)">
                  <span class="face">{{ peopleFaces(person.sex, person.id) }}</span>
                  <span class="bloodType">{{ person.blood_type }}</span>
                  <span class="peopleName">{{ person.first_name }} {{ person.last_name }}</span>
                </li>
              </ul>
            </aside>
          </template>
        </ApolloQuery>
      </aside>
      <section class="contents">
        <div v-if="selectedPerson" class="inputContainer">
          <table>
            <tr v-if="contentId !== 0">
              <td>Id</td>
              <td>{{contentId}}</td>
            </tr>
            <input type="hidden" name="id" v-model="inputs.id">
            <tr>
              <td>First Name</td>
              <td>
                <input type="text" name="first_name" v-model="inputs.first_name">
              </td>
            </tr>
            <tr>
              <td>Last Name</td>
              <td>
                <input type="text" name="last_name" v-model="inputs.last_name">
              </td>
            </tr>
            <tr>
              <td>Sex</td>
              <td>
                <select
                  name="sex"
                  v-model="inputs.sex"
                >
                  <option v-for="(value, key) in sexes" :value="value" :key="key">{{ value }}</option>
                </select>
              </td>
            </tr>
            <tr>
              <td>Blood Type</td>
              <td>
                <select
                  name="blood_type"
                  v-model="inputs.blood_type"
                >
                  <option v-for="(value, key) in bloodTypes" :value="value" :key="key">{{ value }}</option>
                </select>
              </td>
            </tr>
            <tr>
              <td>Serve Years</td>
              <td>
                <input type="number" name="serve_years" v-model="inputs.serve_years">
              </td>
            </tr>
            <tr>
              <td>Role</td>
              <td>
                <select
                  name="role"
                  v-model="inputs.role"
                >
                  <option v-for="(value, key) in roles" :value="value" :key="key">{{ value }}</option>
                </select>
              </td>
            </tr>
            <tr>
              <td>Team</td>
              <td>
                <input type="number" name="team" v-model="inputs.team">
              </td>
            </tr>
            <tr>
              <td>From</td>
              <td>
                <input type="text" name="from" v-model="inputs.from">
              </td>
            </tr>
          </table>

          <ul v-if="contentId !== 0">
            <li v-for="(value, key) in selectedPerson.tools" :value="value" :key="key">
              <span>{{ value.__typename === "Equipment" ? value.id : value.id }}</span>
            </li>
          </ul>

          <div class="buttons" v-if="contentId === 0">
            <button v-on:click="postPerson()">Submit</button>
          </div>
          <div class="buttons" v-else>
            <button v-on:click="editPerson(contentId)">Modify</button>
            <button v-on:click="deletePerson(contentId)">Delete</button>
            <button v-on:click="resetContentId">New</button>
          </div>
        </div>
      </section>
    </div>
  </template>

  <script>
  import { ApolloProvider } from 'vue-apollo'
  import ApolloClient from 'apollo-boost'
  import gql from 'graphql-tag'

  const client = new ApolloClient({
    uri: 'http://localhost:4000/', // GraphQL Server URL
  })

  const GET_PEOPLE = gql`
    query GetPeople {
      people {
        id
        first_name
        last_name
        sex
        blood_type
      }
    }
  `

  const GET_PERSON = gql`
    query GetPerson($id: ID!) {
      person(id: $id) {
        id
        first_name
        last_name
        sex
        blood_type
        serve_years
        role
        team
        from   
        tools {
          __typename
          ... on Software {
            id
          }
          ... on Equipment {
            id
          }
        }
      }
    }
  `

  const DELETE_PERSON = gql`
    mutation DeletePerson($id: ID!) {
      deletePerson(id: $id) {
        id
      }
    }
  `

  const POST_PERSON = gql`
    mutation PostPerson($input: PostPersonInput!) {
      postPerson(input: $input) {
        id
        first_name
        last_name
        sex
        blood_type
        serve_years
        role
        team
        from
      }
    }
  `

  const EDIT_PERSON = gql`
    mutation EditTeam($id: ID!, $input: PostPersonInput!) {
      editPerson(id: $id, input: $input) {
        id
        first_name
        last_name
        sex
        blood_type
        serve_years
        role
        team
        from
      }
    }
  `

  export default {
    provide: () => ({
      apolloProvider: new ApolloProvider({ defaultClient: client }),
    }),
    data () {
      return {
        contentId: 0,
        sexes: ["male", "female"],
        bloodTypes: ["A", "B", "AB", "O"],
        roles: ["developer", "designer", "planner"],
        inputs: {
          manager: "",
          office: "",
          extension_number: "",
          mascot: "",
          cleaning_duty: "",
          project: "",
        },
        bySex: {
          male: ["ğŸ§‘ğŸ¿", "ğŸ‘¨ğŸ»", "ğŸ‘¦ğŸ¼", "â€ğŸ§“ğŸ½", "ğŸ§”ğŸ¾"],
          female: ["ğŸ‘©ğŸ»", "ğŸ‘§ğŸ¼", "ğŸ‘©ğŸ½â€ğŸ¦°", "ğŸ‘©ğŸ¾â€ğŸ¦±", "ğŸ‘±ğŸ¿â€â™€ï¸"],
        },
        selectedPerson: null,
        GET_PEOPLE,
        GET_PERSON,
        DELETE_PERSON,
        POST_PERSON,
        EDIT_PERSON,
      }
    },
    methods: {
      peopleFaces(sex, id) {
        return this.bySex[sex][id % this.bySex[sex].length]
      },
      async selectPerson (id) {
        this.contentId = id
        const { data } = await this.$apollo.query({ query: this.GET_PERSON, variables: { id } })        
        this.selectedPerson = data.person
        this.inputs = {
          first_name: data.person.first_name,
          last_name: data.person.last_name,
          sex: data.person.sex,
          blood_type: data.person.blood_type,
          serve_years: data.person.serve_years,
          role: data.person.role,
          team: data.person.team,
          from: data.person.from,
        }
      },
      resetContentId() {
        this.contentId = 0
        this.inputs = {
          first_name: "",
          last_name: "",
          sex: "",
          blood_type: "",
          serve_years: 0,
          role: "",
          team: 0,
          from: "",
        }
      },
      async deletePerson (id) {
        if (window.confirm('ì´ í•­ëª©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
          await this.$apollo.mutate({ 
            mutation: this.DELETE_PERSON, 
            variables: { id },
            refetchQueries: [{ query: this.GET_PEOPLE }] // ì‚­ì œ í›„ íŒ€ ëª©ë¡ì„ ì—…ë°ì´íŠ¸
          })
          alert(`${id} í•­ëª©ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`)
          this.resetContentId() // ì‚­ì œ í›„ ì…ë ¥ í•„ë“œë¥¼ ì´ˆê¸°í™”
        }
      },
      async editPerson (id) {
        this.inputs.serve_years = Number(this.inputs.serve_years)
        this.inputs.team = Number(this.inputs.team)      
        await this.$apollo.mutate({ 
          mutation: this.EDIT_PERSON,
          variables: {
            id,
            input: this.inputs
          },
          refetchQueries: [{ query: this.GET_PEOPLE }] // ìˆ˜ì • í›„ íŒ€ ëª©ë¡ì„ ì—…ë°ì´íŠ¸
        })
        alert(`${id} í•­ëª©ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.`)
      },
      async postPerson () {
        this.inputs.serve_years = Number(this.inputs.serve_years)
        this.inputs.team = Number(this.inputs.team)
        const response = await this.$apollo.mutate({ // response ê°ì²´ì˜ data í”„ë¡œí¼í‹°ì— mutationì˜ ê²°ê³¼ë¥¼ ë‹´ê¸°
          mutation: this.POST_PERSON,
          variables: {
            input: this.inputs
          },
          refetchQueries: [{ query: this.GET_PEOPLE }] // ì¶”ê°€ í›„ íŒ€ ëª©ë¡ì„ ì—…ë°ì´íŠ¸
        })
        alert(`${response.data.postPerson.id} í•­ëª©ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.`)
        this.resetContentId() // ì¶”ê°€ í›„ ì…ë ¥ í•„ë“œë¥¼ ì´ˆê¸°í™”
      }
    },
    created() {
      this.resetContentId(); // ì´ˆê¸°í™”ë©´ êµ¬ë™ì‹œ, ì…ë ¥ í•„ë“œë¥¼ ì´ˆê¸°í™”
      this.selectedPerson = {}; // ì´ˆê¸°í™”ë©´ êµ¬ë™ì‹œ, selectedPersonì„ ë¹ˆ ê°ì²´ë¡œ ì´ˆê¸°í™”
    },
  }
  </script>



1. ë¦¬ì•¡íŠ¸ë‘ ë‹¤ë¥¸ì 1 : ìì¬ í‘œì‹œ ë¶€ë¶„ì—ì„œ ë¦¬ì•¡íŠ¸ BFF ì•±ê³¼ì˜ ì°¨ë¶„ì´ ìƒê¸´ ì´ìœ ëŠ” apollo-boostì˜ í•œê³„ ë•Œë¬¸ì´ë‹¤.
  ë·°ëŠ” apollo-boostë¥¼ ì“°ê¸° ë•Œë¬¸ì¸ì§€, apollo-clientë¥¼ ì‚¬ìš©í•œ ë¦¬ì•¡íŠ¸ì•±ì—ì„œ ê°€ëŠ¥í–ˆë˜
    ... on Equipment {
      id
      count // ì´ ë¶€ë¶„ì„ ì·¨ë“í•˜ëŠ” ê²ƒì´ ì‘ë™í•˜ì§€ ì•ŠëŠ”ë‹¤.
    }
  ë”°ë¼ì„œ ìì¬ë¥¼ í‘œì‹œí•˜ëŠ” ë¶€ë¶„ì—ì„œ countì˜ í‘œì‹œì™€, 
  INCREASE_EQUIPMENT ì¿¼ë¦¬ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë²„íŠ¼ì— ëŒ€í•´ì„œëŠ” ìƒëµí•˜ë„ë¡ í•˜ê² ë‹¤.
  ë¬¼ë¡ , ë·°ë„ ë” ìƒì„¸í•œ BFF ê¸°ëŠ¥ì„ ì“°ë ¤ë©´ apollo-clientì„ ì“°ê¸°ë„ í•˜ì§€ë§Œ, 
  apollo-clientê°€ ë¦¬ì•¡íŠ¸ì— ë¹„í•´ ì„¤ì •ì´ ì¢€ ë³µì¡í•´ì„œ,
  ê°œì¸í”„ë¡œì íŠ¸ì—ì„œëŠ” apollo-boostê°€ ì¼ë°˜ì ì¸ ê²ƒ ê°™ë‹¤.

1. ë¦¬ì•¡íŠ¸ë‘ ë‹¤ë¥¸ì 2 : postPersonì„ í•  ê²½ìš° input ì°½ì´ Null ê°’ì¼ ë•Œ ì˜ˆì™¸ì²˜ë¦¬ê°€ í•„ìš”í•˜ë‹¤.
  ë¦¬ì•¡íŠ¸ëŠ” POSTë¥¼ ë‚ ë¦´ ë•Œ Null ì²˜ë¦¬ë¥¼ ìë™ìœ¼ë¡œ í•´ì£¼ì§€ë§Œ ë·°ëŠ” ê·¸ë ‡ì§€ ì•Šì•˜ë‹¤.
  ê°€ëŠ¥í•œí•œ ë™ì¼í•œ ì†ŒìŠ¤ ì½”ë“œë¡œ ë‘ê¸° ìœ„í•´ ì¼ë‹¨ ì´ë²ˆ ë·°2 ì½”ë“œì—ì„œëŠ” ì˜ˆì™¸ì²˜ë¦¬ë¥¼ í•˜ì§€ ì•Šì€ ì±„ë¡œ ë‘ì—ˆë‹¤.



1. í…ŒìŠ¤íŠ¸ : People í™”ë©´ì—ì„œ ì¡°íšŒ, ì‚­ì œ, ìˆ˜ì •, ì¶”ê°€ê°€ ì˜ ë˜ëŠ”ì§€ í™•ì¸
  BFF server ì•± ì¼œì ¸ìˆëŠ”ì§€ í™•ì¸í•˜ê³ , êº¼ì ¸ìˆë‹¤ë©´ npm startë¡œ ì‹¤í–‰ì‹œì¼œë‘ê³  ì‹œì‘í•œë‹¤.
  $ cd app1
  $ npm run serve
  http://localhost:8080
  ìƒë‹¨ì˜ People ë©”ë‰´ í´ë¦­
  People í™”ë©´ì—ì„œ ì¡°íšŒ, ì‚­ì œ, ìˆ˜ì •, ì¶”ê°€ê°€ ì˜ ë˜ëŠ”ì§€ í™•ì¸
